# Communication
## Summary
本システムには`Micon-Android`と`Android-Server`で通信が発生します。このドキュメントは、これらの通信における開発メンバーの意識を統一することを目的として書かれました。

## Micon-Android
MiconとAndroidでは以下のデータを共有する必要があります。

### Android -> Micon
- 自分のユーザーID
- 自分の攻撃力

**Note:**
- 自分のユーザーIDはマイコンが送信するデータとして必要です。
- ユーザーIDはサーバーによって割り振られ、現状0から15の範囲をとります。

### Micon -> Android
- 受信したユーザーID

**Note:**
- マイコンは受信したユーザーIDをAndroidに、Androidはサーバーにただ渡すだけです。この2つはゲームロジックについては責務を負わず、サーバーだけがその責務を負っています。

## Android-Server
Androidとサーバー間でやりとりするデータの内容の話はAPIの話になるので、ここには書きませんが、本システムでは`Bidirectional Streaming RPC`が採用されていることに注意してください。

**Note:**
- release-v1で実装されない機能についてはなにも書かれていないことに注意してください。

`Bidirectional Streaming RPC`は、よくあるWEBアプリケーションと同様にクライアントからサーバーにデータを送れると同時にサーバーからクライアントにデータを送れる、その名の通りBidirectionalな通信です。そのため、クライアントとサーバーのアプリケーションはそのことを考慮して実装しなければなりません。

たとえば、クライアントは以下のようなAPIをリクエストとしてサーバーに送ります。
- ルームを作成して入室する
- ルームに参加する
- インベントリーにアイテムを格納する
- ゲーム準備完了を通知する
- ゲームを開始する
- 撃たれたことを通知する
- アイテムを使用する

サーバーは以上のAPIに対するレスポンスに加え、以下のようなものをクライアントに送っています。

- hogeくんがルームに入ってきたこと
- hogeくんがゲーム開始準備を済ませたこと
- ルームオーナーによってゲームが開始されたこと
- 医療キットの使用によってhogeくんのHPが回復したこと
- hogeくんがpiyoくんにkillされたこと
- ゲームが終了したこと/ゲームのリザルト

**Note:**
- 上にかかれたものは`自然言語でかかれた高度なレベルで伝えたいこと`ですが、実装上では`JoinRoomResponseを格納したRoomMessage`のようなただのデータが送信されています。